<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stats - J2025Scorecard | JEE Advanced 2025</title>
    <meta name="description" content="JEE Advanced 2025 Score Distribution, leaderboard and other stats">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="msvalidate.01" content="0B663B74E91F444873E184891C454655" />
    <script
      data-goatcounter="https://novadrone16.goatcounter.com/count"
      async
      src="//gc.zgo.at/count.js"
    ></script>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-NZ2TCWXZLL"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-NZ2TCWXZLL");
    </script>

    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      }

      .card {
        background: rgba(30, 41, 59, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(148, 163, 184, 0.1);
      }

      .card:hover {
        background: rgba(30, 41, 59, 0.9);
        transform: translateY(-2px);
        transition: all 0.3s ease;
      }

      .stats-number {
        background: linear-gradient(45deg, #3b82f6, #8b5cf6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .subject-badge {
        position: relative;
        overflow: hidden;
      }

      .subject-badge::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transition: left 0.5s;
      }

      .subject-badge:hover::before {
        left: 100%;
      }

      .chart-container {
        position: relative;
        height: 300px;
        background: rgba(15, 23, 42, 0.6);
        border-radius: 12px;
        padding: 16px;
      }

      .toggle-btn {
        background: linear-gradient(45deg, #3b82f6, #8b5cf6);
        transition: all 0.3s ease;
      }

      .toggle-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
      }

      .leaderboard-item {
        background: linear-gradient(
          90deg,
          rgba(59, 130, 246, 0.1),
          rgba(139, 92, 246, 0.1)
        );
        border-left: 4px solid;
        animation: slideIn 0.5s ease forwards;
        opacity: 0;
        transform: translateX(-20px);
      }

      .leaderboard-item:nth-child(1) {
        border-left-color: #ffd700;
        animation-delay: 0.1s;
      }

      .leaderboard-item:nth-child(2) {
        border-left-color: #c0c0c0;
        animation-delay: 0.2s;
      }

      .leaderboard-item:nth-child(3) {
        border-left-color: #cd7f32;
        animation-delay: 0.3s;
      }

      .leaderboard-item:nth-child(n + 4) {
        border-left-color: #3b82f6;
      }

      @keyframes slideIn {
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .pulse-dot {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }

        50% {
          opacity: 0.5;
        }
      }

      .comparison-bar {
        height: 8px;
        border-radius: 4px;
        background: rgb(55 65 81 / var(--tw-bg-opacity, 1));
        position: relative;
        overflow: hidden;
      }

      .comparison-bar::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          left: -100%;
        }

        100% {
          left: 100%;
        }
      }
    </style>
  </head>

  <body class="min-h-screen text-white">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold mb-4">
          <i class="fas fa-chart-line mr-3 text-blue-400"></i>
          Stats - J2025Scorecard (JEE Adv)
        </h1>
        <div class="flex items-center justify-center text-gray-300 mb-2">
          <i class="fas fa-clock mr-2"></i>
          <span id="lastUpdated">Loading...</span>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="card rounded-xl p-6">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-300 text-sm">Total Scores Recorded</p>
              <p class="stats-number text-3xl font-bold" id="totalCount">0</p>
            </div>
            <i class="fas fa-users text-blue-400 text-2xl"></i>
          </div>
        </div>
        <div class="card rounded-xl p-6">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-300 text-sm">Active Users (30 min)</p>
              <p class="stats-number text-3xl font-bold" id="activeUsers">0</p>
            </div>
            <i class="fas fa-user-clock text-green-400 text-2xl"></i>
          </div>
        </div>
        <div class="card rounded-xl p-6">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-300 text-sm">Highest Score</p>
              <p class="stats-number text-3xl font-bold" id="highestScore">0</p>
            </div>
            <i class="fas fa-trophy text-yellow-400 text-2xl"></i>
          </div>
        </div>
        <div class="card rounded-xl p-6">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-300 text-sm">250+ Scorers</p>
              <p class="stats-number text-3xl font-bold" id="top250Count">0</p>
            </div>
            <i class="fas fa-medal text-purple-400 text-2xl"></i>
          </div>
        </div>
      </div>

      <div class="card rounded-xl p-6 mb-8">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold flex items-center">
            <i class="fas fa-chart-bar mr-3 text-blue-400"></i>
            Score Distribution
          </h2>
          <button
            id="toggleView"
            class="toggle-btn px-4 py-2 rounded-lg text-white font-semibold flex items-center"
          >
            <i class="fas fa-table"></i>
          </button>
        </div>

        <div id="tableView">
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="border-b border-gray-600">
                  <th class="text-left py-3 px-4">Score Range</th>
                  <th class="text-right py-3 px-4">Students</th>
                  <th class="text-right py-3 px-4">Percentage</th>
                  <th class="text-left py-3 px-4">Distribution</th>
                </tr>
              </thead>
              <tbody id="distributionTable"></tbody>
            </table>
          </div>
        </div>

        <div id="chartView" class="hidden">
          <div class="chart-container">
            <canvas id="distributionChart"></canvas>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <div class="card rounded-xl p-6">
          <h2 class="text-2xl font-bold mb-6 flex items-center">
            <i class="fas fa-balance-scale mr-3 text-yellow-400"></i>
            Paper Difficulty Analysis
          </h2>
          <div class="space-y-4">
            <div>
              <div class="flex justify-between items-center mb-2">
                <span class="text-gray-300">Paper 1 Performance</span>
                <span class="text-green-400 font-semibold" id="paper1Percentage"
                  >0%</span
                >
              </div>
              <div class="comparison-bar">
                <div
                  class="h-full bg-green-400 rounded"
                  id="paper1Bar"
                  style="width: 0%"
                ></div>
              </div>
              <p class="text-xs text-gray-400 mt-1">
                Students who scored higher in Paper 1
              </p>
            </div>
            <div>
              <div class="flex justify-between items-center mb-2">
                <span class="text-gray-300">Paper 2 Performance</span>
                <span class="text-blue-400 font-semibold" id="paper2Percentage"
                  >0%</span
                >
              </div>
              <div class="comparison-bar">
                <div
                  class="h-full bg-blue-400 rounded"
                  id="paper2Bar"
                  style="width: 0%"
                ></div>
              </div>
              <p class="text-xs text-gray-400 mt-1">
                Students who scored higher in Paper 2
              </p>
            </div>
            <div>
              <div class="flex justify-between items-center mb-2">
                <span class="text-gray-300">Equal Performance</span>
                <span class="text-yellow-400 font-semibold" id="equalPercentage"
                  >0%</span
                >
              </div>
              <div class="comparison-bar">
                <div
                  class="h-full bg-yellow-400 rounded"
                  id="equalBar"
                  style="width: 0%"
                ></div>
              </div>
              <p class="text-xs text-gray-400 mt-1">
                Students who scored equal in both the papers
              </p>
            </div>
          </div>
        </div>

        <div class="card rounded-xl p-6">
          <h2 class="text-2xl font-bold mb-6 flex items-center">
            <i class="fas fa-microscope mr-3 text-cyan-400"></i>
            Subject-wise Paper Comparison
          </h2>
          <div class="space-y-4">
            <div class="bg-red-500/10 p-4 rounded-lg border border-red-500/20">
              <h4 class="font-semibold text-red-300 mb-2">Physics</h4>
              <div class="text-sm text-gray-300" id="physicsComparison"></div>
            </div>
            <div
              class="bg-blue-500/10 p-4 rounded-lg border border-blue-500/20"
            >
              <h4 class="font-semibold text-blue-300 mb-2">Chemistry</h4>
              <div class="text-sm text-gray-300" id="chemistryComparison"></div>
            </div>
            <div
              class="bg-green-500/10 p-4 rounded-lg border border-green-500/20"
            >
              <h4 class="font-semibold text-green-300 mb-2">Mathematics</h4>
              <div class="text-sm text-gray-300" id="mathsComparison"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="card rounded-xl p-6 mb-8">
        <div class="mb-4">
          <div
            class="flex flex-col sm:flex-row sm:items-center sm:justify-between w-full"
          >
            <div
              class="flex flex-col sm:flex-row sm:items-center sm:justify-start"
            >
              <div class="flex items-center space-x-2">
                <i class="fas fa-question-circle text-green-400 text-2xl"></i>
                <h2 class="text-2xl font-bold text-white">
                  Question-wise Analysis
                </h2>
              </div>
              <p class="text-sm text-gray-400 mt-1 sm:mt-0 sm:ml-4">
                (Click on any image to view question details)
              </p>
            </div>
            <div class="ml-auto">
              <span
                class="inline-flex items-center px-3 py-1 rounded-lg text-xs font-medium bg-blue-600/20 hover:bg-blue-600/30 text-blue-300 border border-blue-600/30"
              >
                Updates after every 6 hr
              </span>
            </div>
          </div>
        </div>

        <div class="flex flex-wrap gap-2 mb-6">
          <button
            onclick="showSubjectAnalysis('physics', this)"
            class="analysis-toggle-btn bg-gray-600/20 hover:bg-gray-600/30 text-gray-300 px-4 py-2 rounded-lg border border-gray-600/30 transition-all duration-300 active"
          >
            <i class="fas fa-atom mr-2"></i>Physics
          </button>
          <button
            onclick="showSubjectAnalysis('chemistry', this)"
            class="analysis-toggle-btn bg-gray-600/20 hover:bg-gray-600/30 text-gray-300 px-4 py-2 rounded-lg border border-gray-600/30 transition-all duration-300"
          >
            <i class="fas fa-vial mr-2"></i>Chemistry
          </button>
          <button
            onclick="showSubjectAnalysis('maths', this)"
            class="analysis-toggle-btn bg-gray-600/20 hover:bg-gray-600/30 text-gray-300 px-4 py-2 rounded-lg border border-gray-600/30 transition-all duration-300"
          >
            <i class="fas fa-square-root-alt mr-2"></i>Mathematics
          </button>
        </div>

        <div id="questionAnalysisContainer">
          <div id="physics-analysis" class="subject-analysis">
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-gray-600">
                    <th class="text-left py-3 px-4">Question</th>
                    <th class="text-center py-3 px-4">Paper</th>
                    <th class="text-center py-3 px-4">Section</th>
                    <th
                      class="text-right py-3 px-4 cursor-pointer hover:bg-gray-700/50 transition-colors"
                      onclick="sortTable('correct', this)"
                    >
                      Correct %
                      <i class="fas fa-sort ml-1 text-gray-400"></i>
                    </th>
                    <th
                      class="text-right py-3 px-4 cursor-pointer hover:bg-gray-700/50 transition-colors"
                      onclick="sortTable('incorrect', this)"
                    >
                      Incorrect %
                      <i class="fas fa-sort ml-1 text-gray-400"></i>
                    </th>
                    <th
                      class="text-right py-3 px-4 cursor-pointer hover:bg-gray-700/50 transition-colors"
                      onclick="sortTable('partial', this)"
                    >
                      Partial %
                      <i class="fas fa-sort ml-1 text-gray-400"></i>
                    </th>
                    <th
                      class="text-right py-3 px-4 cursor-pointer hover:bg-gray-700/50 transition-colors"
                      onclick="sortTable('unattempted', this)"
                    >
                      Unattempted %
                      <i class="fas fa-sort ml-1 text-gray-400"></i>
                    </th>
                    <!--<th class="text-left py-3 px-4">Performance</th>-->
                  </tr>
                </thead>
                <tbody id="physics-table-body"></tbody>
              </table>
            </div>
          </div>

          <div id="chemistry-analysis" class="subject-analysis hidden">
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-gray-600">
                    <th class="text-left py-3 px-4">Question</th>
                    <th class="text-center py-3 px-4">Paper</th>
                    <th class="text-center py-3 px-4">Section</th>
                    <th
                      class="text-right py-3 px-4 cursor-pointer hover:bg-gray-700/50 transition-colors"
                      onclick="sortTable('correct', this)"
                    >
                      Correct %
                      <i class="fas fa-sort ml-1 text-gray-400"></i>
                    </th>
                    <th
                      class="text-right py-3 px-4 cursor-pointer hover:bg-gray-700/50 transition-colors"
                      onclick="sortTable('incorrect', this)"
                    >
                      Incorrect %
                      <i class="fas fa-sort ml-1 text-gray-400"></i>
                    </th>
                    <th
                      class="text-right py-3 px-4 cursor-pointer hover:bg-gray-700/50 transition-colors"
                      onclick="sortTable('partial', this)"
                    >
                      Partial %
                      <i class="fas fa-sort ml-1 text-gray-400"></i>
                    </th>
                    <th
                      class="text-right py-3 px-4 cursor-pointer hover:bg-gray-700/50 transition-colors"
                      onclick="sortTable('unattempted', this)"
                    >
                      Unattempted %
                      <i class="fas fa-sort ml-1 text-gray-400"></i>
                    </th>
                  </tr>
                </thead>
                <tbody id="chemistry-table-body"></tbody>
              </table>
            </div>
          </div>

          <div id="maths-analysis" class="subject-analysis hidden">
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-gray-600">
                    <th class="text-left py-3 px-4">Question</th>
                    <th class="text-center py-3 px-4">Paper</th>
                    <th class="text-center py-3 px-4">Section</th>
                    <th
                      class="text-right py-3 px-4 cursor-pointer hover:bg-gray-700/50 transition-colors"
                      onclick="sortTable('correct', this)"
                    >
                      Correct %
                      <i class="fas fa-sort ml-1 text-gray-400"></i>
                    </th>
                    <th
                      class="text-right py-3 px-4 cursor-pointer hover:bg-gray-700/50 transition-colors"
                      onclick="sortTable('incorrect', this)"
                    >
                      Incorrect %
                      <i class="fas fa-sort ml-1 text-gray-400"></i>
                    </th>
                    <th
                      class="text-right py-3 px-4 cursor-pointer hover:bg-gray-700/50 transition-colors"
                      onclick="sortTable('partial', this)"
                    >
                      Partial %
                      <i class="fas fa-sort ml-1 text-gray-400"></i>
                    </th>
                    <th
                      class="text-right py-3 px-4 cursor-pointer hover:bg-gray-700/50 transition-colors"
                      onclick="sortTable('unattempted', this)"
                    >
                      Unattempted %
                      <i class="fas fa-sort ml-1 text-gray-400"></i>
                    </th>
                  </tr>
                </thead>
                <tbody id="maths-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="card rounded-xl p-6 mb-8">
        <div class="mb-4">
          <div
            class="flex flex-col sm:flex-row sm:items-center sm:justify-between w-full"
          >
            <div
              class="flex flex-col sm:flex-row sm:items-center sm:justify-start"
            >
              <div class="flex items-center space-x-2">
                <i class="fas fa-chart-line text-purple-400 text-2xl"></i>
                <h2 class="text-2xl font-bold text-white">
                  Performance Extremes Analysis
                </h2>
              </div>
              <p class="text-sm text-gray-400 mt-1 sm:mt-0 sm:ml-4">
                (Click on any image to view question details)
              </p>
            </div>
            <div class="ml-auto">
              <span
                class="inline-flex items-center px-3 py-1 rounded-lg text-xs font-medium bg-blue-600/20 hover:bg-blue-600/30 text-blue-300 border border-blue-600/30"
              >
                Updates after every 6 hr
              </span>
            </div>
          </div>
        </div>

        <div class="flex flex-wrap gap-2 mb-6">
          <button
            onclick="populatePerformanceExtremes('physics', this)"
            class="subject-toggle-btn active bg-gray-600/20 hover:bg-gray-600/30 text-gray-300 px-4 py-2 rounded-lg border border-gray-600/30 transition-all duration-300"
          >
            <i class="fas fa-atom mr-2"></i>Physics
          </button>
          <button
            onclick="populatePerformanceExtremes('chemistry', this)"
            class="subject-toggle-btn bg-gray-600/20 hover:bg-gray-600/30 text-gray-300 px-4 py-2 rounded-lg border border-gray-600/30 transition-all duration-300"
          >
            <i class="fas fa-vial mr-2"></i>Chemistry
          </button>
          <button
            onclick="populatePerformanceExtremes('maths', this)"
            class="subject-toggle-btn bg-gray-600/20 hover:bg-gray-600/30 text-gray-300 px-4 py-2 rounded-lg border border-gray-600/30 transition-all duration-300"
          >
            <i class="fas fa-square-root-alt mr-2"></i>Mathematics
          </button>
        </div>
        <div id="physics-extremes" class="subject-extremes">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="space-y-4">
              <div
                class="bg-green-500/10 p-4 rounded-lg border border-green-500/20"
              >
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-green-300">
                    Highest Correct Rate
                  </h4>
                  <span
                    class="text-green-400 font-bold"
                    id="physics-highest-correct-rate"
                    >0%</span
                  >
                </div>
                <div class="flex items-center space-x-4">
                  <img
                    id="physics-highest-correct-question"
                    src=""
                    alt="Question"
                    class="w-20 h-16 object-contain bg-white rounded border"
                  />
                  <div class="flex-1">
                    <p class="text-sm text-gray-300">
                      <span class="font-medium">Paper:</span>
                      <span id="physics-highest-correct-paper">-</span> |
                      <span class="font-medium">Section:</span>
                      <span id="physics-highest-correct-section">-</span>
                    </p>
                    <p class="text-xs text-gray-400 mt-1">
                      Correct:
                      <span id="physics-highest-correct-count">0</span> students
                    </p>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                      <div
                        id="physics-highest-correct-bar"
                        class="bg-green-400 h-2 rounded-full"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>

              <div
                class="bg-red-500/10 p-4 rounded-lg border border-red-500/20"
              >
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-red-300">
                    Highest Incorrect Rate
                  </h4>
                  <span
                    class="text-red-400 font-bold"
                    id="physics-highest-incorrect-rate"
                    >0%</span
                  >
                </div>
                <div class="flex items-center space-x-4">
                  <img
                    id="physics-highest-incorrect-question"
                    src=""
                    alt="Question"
                    class="w-20 h-16 object-contain bg-white rounded border"
                  />
                  <div class="flex-1">
                    <p class="text-sm text-gray-300">
                      <span class="font-medium">Paper:</span>
                      <span id="physics-highest-incorrect-paper">-</span> |
                      <span class="font-medium">Section:</span>
                      <span id="physics-highest-incorrect-section">-</span>
                    </p>
                    <p class="text-xs text-gray-400 mt-1">
                      Incorrect:
                      <span id="physics-highest-incorrect-count">0</span>
                      students
                    </p>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                      <div
                        id="physics-highest-incorrect-bar"
                        class="bg-red-400 h-2 rounded-full"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="space-y-4">
              <div
                class="bg-orange-500/10 p-4 rounded-lg border border-orange-500/20"
              >
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-orange-300">
                    Lowest Correct Rate
                  </h4>
                  <span
                    class="text-orange-400 font-bold"
                    id="physics-lowest-correct-rate"
                    >0%</span
                  >
                </div>
                <div class="flex items-center space-x-4">
                  <img
                    id="physics-lowest-correct-question"
                    src=""
                    alt="Question"
                    class="w-20 h-16 object-contain bg-white rounded border"
                  />
                  <div class="flex-1">
                    <p class="text-sm text-gray-300">
                      <span class="font-medium">Paper:</span>
                      <span id="physics-lowest-correct-paper">-</span> |
                      <span class="font-medium">Section:</span>
                      <span id="physics-lowest-correct-section">-</span>
                    </p>
                    <p class="text-xs text-gray-400 mt-1">
                      Correct:
                      <span id="physics-lowest-correct-count">0</span> students
                    </p>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                      <div
                        id="physics-lowest-correct-bar"
                        class="bg-orange-400 h-2 rounded-full"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>

              <div
                class="bg-yellow-500/10 p-4 rounded-lg border border-yellow-500/20"
              >
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-yellow-300">Most Avoided</h4>
                  <span
                    class="text-yellow-400 font-bold"
                    id="physics-highest-unattempted-rate"
                    >0%</span
                  >
                </div>
                <div class="flex items-center space-x-4">
                  <img
                    id="physics-highest-unattempted-question"
                    src=""
                    alt="Question"
                    class="w-20 h-16 object-contain bg-white rounded border"
                  />
                  <div class="flex-1">
                    <p class="text-sm text-gray-300">
                      <span class="font-medium">Paper:</span>
                      <span id="physics-highest-unattempted-paper">-</span> |
                      <span class="font-medium">Section:</span>
                      <span id="physics-highest-unattempted-section">-</span>
                    </p>
                    <p class="text-xs text-gray-400 mt-1">
                      Unattempted:
                      <span id="physics-highest-unattempted-count">0</span>
                      students
                    </p>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                      <div
                        id="physics-highest-unattempted-bar"
                        class="bg-yellow-400 h-2 rounded-full"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="chemistry-extremes" class="subject-extremes hidden">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="space-y-4">
              <div
                class="bg-green-500/10 p-4 rounded-lg border border-green-500/20"
              >
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-green-300">
                    Highest Correct Rate
                  </h4>
                  <span
                    class="text-green-400 font-bold"
                    id="chemistry-highest-correct-rate"
                    >0%</span
                  >
                </div>
                <div class="flex items-center space-x-4">
                  <img
                    id="chemistry-highest-correct-question"
                    src=""
                    alt="Question"
                    class="w-20 h-16 object-contain bg-white rounded border"
                  />
                  <div class="flex-1">
                    <p class="text-sm text-gray-300">
                      <span class="font-medium">Paper:</span>
                      <span id="chemistry-highest-correct-paper">-</span> |
                      <span class="font-medium">Section:</span>
                      <span id="chemistry-highest-correct-section">-</span>
                    </p>
                    <p class="text-xs text-gray-400 mt-1">
                      Correct:
                      <span id="chemistry-highest-correct-count">0</span>
                      students
                    </p>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                      <div
                        id="chemistry-highest-correct-bar"
                        class="bg-green-400 h-2 rounded-full"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>

              <div
                class="bg-red-500/10 p-4 rounded-lg border border-red-500/20"
              >
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-red-300">
                    Highest Incorrect Rate
                  </h4>
                  <span
                    class="text-red-400 font-bold"
                    id="chemistry-highest-incorrect-rate"
                    >0%</span
                  >
                </div>
                <div class="flex items-center space-x-4">
                  <img
                    id="chemistry-highest-incorrect-question"
                    src=""
                    alt="Question"
                    class="w-20 h-16 object-contain bg-white rounded border"
                  />
                  <div class="flex-1">
                    <p class="text-sm text-gray-300">
                      <span class="font-medium">Paper:</span>
                      <span id="chemistry-highest-incorrect-paper">-</span> |
                      <span class="font-medium">Section:</span>
                      <span id="chemistry-highest-incorrect-section">-</span>
                    </p>
                    <p class="text-xs text-gray-400 mt-1">
                      Incorrect:
                      <span id="chemistry-highest-incorrect-count">0</span>
                      students
                    </p>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                      <div
                        id="chemistry-highest-incorrect-bar"
                        class="bg-red-400 h-2 rounded-full"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="space-y-4">
              <div
                class="bg-orange-500/10 p-4 rounded-lg border border-orange-500/20"
              >
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-orange-300">
                    Lowest Correct Rate
                  </h4>
                  <span
                    class="text-orange-400 font-bold"
                    id="chemistry-lowest-correct-rate"
                    >0%</span
                  >
                </div>
                <div class="flex items-center space-x-4">
                  <img
                    id="chemistry-lowest-correct-question"
                    src=""
                    alt="Question"
                    class="w-20 h-16 object-contain bg-white rounded border"
                  />
                  <div class="flex-1">
                    <p class="text-sm text-gray-300">
                      <span class="font-medium">Paper:</span>
                      <span id="chemistry-lowest-correct-paper">-</span> |
                      <span class="font-medium">Section:</span>
                      <span id="chemistry-lowest-correct-section">-</span>
                    </p>
                    <p class="text-xs text-gray-400 mt-1">
                      Correct:
                      <span id="chemistry-lowest-correct-count">0</span>
                      students
                    </p>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                      <div
                        id="chemistry-lowest-correct-bar"
                        class="bg-orange-400 h-2 rounded-full"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>

              <div
                class="bg-yellow-500/10 p-4 rounded-lg border border-yellow-500/20"
              >
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-yellow-300">Most Avoided</h4>
                  <span
                    class="text-yellow-400 font-bold"
                    id="chemistry-highest-unattempted-rate"
                    >0%</span
                  >
                </div>
                <div class="flex items-center space-x-4">
                  <img
                    id="chemistry-highest-unattempted-question"
                    src=""
                    alt="Question"
                    class="w-20 h-16 object-contain bg-white rounded border"
                  />
                  <div class="flex-1">
                    <p class="text-sm text-gray-300">
                      <span class="font-medium">Paper:</span>
                      <span id="chemistry-highest-unattempted-paper">-</span> |
                      <span class="font-medium">Section:</span>
                      <span id="chemistry-highest-unattempted-section">-</span>
                    </p>
                    <p class="text-xs text-gray-400 mt-1">
                      Unattempted:
                      <span id="chemistry-highest-unattempted-count">0</span>
                      students
                    </p>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                      <div
                        id="chemistry-highest-unattempted-bar"
                        class="bg-yellow-400 h-2 rounded-full"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="maths-extremes" class="subject-extremes hidden">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="space-y-4">
              <div
                class="bg-green-500/10 p-4 rounded-lg border border-green-500/20"
              >
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-green-300">
                    Highest Correct Rate
                  </h4>
                  <span
                    class="text-green-400 font-bold"
                    id="maths-highest-correct-rate"
                    >0%</span
                  >
                </div>
                <div class="flex items-center space-x-4">
                  <img
                    id="maths-highest-correct-question"
                    src=""
                    alt="Question"
                    class="w-20 h-16 object-contain bg-white rounded border"
                  />
                  <div class="flex-1">
                    <p class="text-sm text-gray-300">
                      <span class="font-medium">Paper:</span>
                      <span id="maths-highest-correct-paper">-</span> |
                      <span class="font-medium">Section:</span>
                      <span id="maths-highest-correct-section">-</span>
                    </p>
                    <p class="text-xs text-gray-400 mt-1">
                      Correct:
                      <span id="maths-highest-correct-count">0</span> students
                    </p>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                      <div
                        id="maths-highest-correct-bar"
                        class="bg-green-400 h-2 rounded-full"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>

              <div
                class="bg-red-500/10 p-4 rounded-lg border border-red-500/20"
              >
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-red-300">
                    Highest Incorrect Rate
                  </h4>
                  <span
                    class="text-red-400 font-bold"
                    id="maths-highest-incorrect-rate"
                    >0%</span
                  >
                </div>
                <div class="flex items-center space-x-4">
                  <img
                    id="maths-highest-incorrect-question"
                    src=""
                    alt="Question"
                    class="w-20 h-16 object-contain bg-white rounded border"
                  />
                  <div class="flex-1">
                    <p class="text-sm text-gray-300">
                      <span class="font-medium">Paper:</span>
                      <span id="maths-highest-incorrect-paper">-</span> |
                      <span class="font-medium">Section:</span>
                      <span id="maths-highest-incorrect-section">-</span>
                    </p>
                    <p class="text-xs text-gray-400 mt-1">
                      Incorrect:
                      <span id="maths-highest-incorrect-count">0</span> students
                    </p>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                      <div
                        id="maths-highest-incorrect-bar"
                        class="bg-red-400 h-2 rounded-full"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="space-y-4">
              <div
                class="bg-orange-500/10 p-4 rounded-lg border border-orange-500/20"
              >
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-orange-300">
                    Lowest Correct Rate
                  </h4>
                  <span
                    class="text-orange-400 font-bold"
                    id="maths-lowest-correct-rate"
                    >0%</span
                  >
                </div>
                <div class="flex items-center space-x-4">
                  <img
                    id="maths-lowest-correct-question"
                    src=""
                    alt="Question"
                    class="w-20 h-16 object-contain bg-white rounded border"
                  />
                  <div class="flex-1">
                    <p class="text-sm text-gray-300">
                      <span class="font-medium">Paper:</span>
                      <span id="maths-lowest-correct-paper">-</span> |
                      <span class="font-medium">Section:</span>
                      <span id="maths-lowest-correct-section">-</span>
                    </p>
                    <p class="text-xs text-gray-400 mt-1">
                      Correct:
                      <span id="maths-lowest-correct-count">0</span> students
                    </p>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                      <div
                        id="maths-lowest-correct-bar"
                        class="bg-orange-400 h-2 rounded-full"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>

              <div
                class="bg-yellow-500/10 p-4 rounded-lg border border-yellow-500/20"
              >
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-yellow-300">Most Avoided</h4>
                  <span
                    class="text-yellow-400 font-bold"
                    id="maths-highest-unattempted-rate"
                    >0%</span
                  >
                </div>
                <div class="flex items-center space-x-4">
                  <img
                    id="maths-highest-unattempted-question"
                    src=""
                    alt="Question"
                    class="w-20 h-16 object-contain bg-white rounded border"
                  />
                  <div class="flex-1">
                    <p class="text-sm text-gray-300">
                      <span class="font-medium">Paper:</span>
                      <span id="maths-highest-unattempted-paper">-</span> |
                      <span class="font-medium">Section:</span>
                      <span id="maths-highest-unattempted-section">-</span>
                    </p>
                    <p class="text-xs text-gray-400 mt-1">
                      Unattempted:
                      <span id="maths-highest-unattempted-count">0</span>
                      students
                    </p>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                      <div
                        id="maths-highest-unattempted-bar"
                        class="bg-yellow-400 h-2 rounded-full"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div
        id="questionModal"
        class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden"
      >
        <div
          class="bg-gray-800 rounded-xl max-w-4xl max-h-[90vh] w-full mx-4 overflow-y-auto"
        >
          <div
            class="flex items-center justify-between p-6 border-b border-gray-600"
          >
            <div class="flex items-center space-x-3">
              <i class="fas fa-question-circle text-blue-400 text-xl"></i>
              <h3 class="text-xl font-bold text-white">Question Details</h3>
              <span
                id="modalQuestionNumber"
                class="px-3 py-1 bg-blue-500/20 text-blue-300 rounded-full text-sm"
              ></span>
            </div>
            <button
              onclick="closeQuestionModal()"
              class="text-gray-400 hover:text-white transition-colors"
            >
              <i class="fas fa-times text-xl"></i>
            </button>
          </div>

          <div class="p-6">
            <div class="mb-6">
              <div class="flex flex-wrap gap-3 mb-4">
                <span
                  class="px-3 py-1 bg-purple-500/20 text-purple-300 rounded-full text-sm"
                >
                  <i class="fas fa-file-alt mr-1"></i>
                  Paper: <span id="modalPaperNo">-</span>
                </span>
                <span
                  class="px-3 py-1 bg-green-500/20 text-green-300 rounded-full text-sm"
                >
                  <i class="fas fa-list mr-1"></i>
                  Section: <span id="modalSection">-</span>
                </span>
                <span
                  id="modalSubject"
                  class="px-3 py-1 bg-orange-500/20 text-orange-300 rounded-full text-sm"
                >
                  <i class="fas fa-book mr-1"></i>
                  Subject: -
                </span>
              </div>

              <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div
                  class="bg-green-500/10 p-3 rounded-lg border border-green-500/20 text-center"
                >
                  <div
                    class="text-green-400 font-bold text-lg"
                    id="modalCorrectPct"
                  >
                    0%
                  </div>
                  <div class="text-xs text-gray-400">Correct</div>
                </div>
                <div
                  class="bg-red-500/10 p-3 rounded-lg border border-red-500/20 text-center"
                >
                  <div
                    class="text-red-400 font-bold text-lg"
                    id="modalIncorrectPct"
                  >
                    0%
                  </div>
                  <div class="text-xs text-gray-400">Incorrect</div>
                </div>
                <div
                  class="bg-yellow-500/10 p-3 rounded-lg border border-yellow-500/20 text-center"
                >
                  <div
                    class="text-yellow-400 font-bold text-lg"
                    id="modalPartialPct"
                  >
                    0%
                  </div>
                  <div class="text-xs text-gray-400">Partial</div>
                </div>
                <div
                  class="bg-gray-500/10 p-3 rounded-lg border border-gray-500/20 text-center"
                >
                  <div
                    class="text-gray-400 font-bold text-lg"
                    id="modalUnattemptedPct"
                  >
                    0%
                  </div>
                  <div class="text-xs text-gray-400">Unattempted</div>
                </div>
              </div>
            </div>

            <div class="space-y-6">
              <div class="bg-gray-700/50 p-4 rounded-lg">
                <h4 class="text-lg font-semibold mb-3 flex items-center">
                  <i class="fas fa-question mr-2 text-blue-400"></i>
                  Question
                </h4>
                <div class="bg-white p-4 rounded-lg">
                  <img
                    id="modalQuestionImg"
                    src=""
                    alt="Question"
                    class="w-full h-auto max-h-96 object-contain mx-auto"
                  />
                </div>
              </div>

              <div class="bg-gray-700/50 p-4 rounded-lg">
                <h4 class="text-lg font-semibold mb-3 flex items-center">
                  <i class="fas fa-check-circle mr-2 text-green-400"></i>
                  Correct Answer
                </h4>
                <div class="bg-white p-4 rounded-lg">
                  <div id="modalAnswerImgContainer" class="space-y-4"></div>
                  <!--<img id="modalAnswerImg" src="" alt="Answer"
                                    class="w-full h-auto max-h-96 object-contain mx-auto">-->
                </div>
              </div>
            </div>

            <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
              <div
                class="bg-blue-500/10 p-4 rounded-lg border border-blue-500/20"
              >
                <h5 class="font-semibold text-blue-300 mb-2">
                  Student Responses
                </h5>
                <div class="space-y-2">
                  <div class="flex justify-between">
                    <span class="text-sm text-gray-300">Correct:</span>
                    <span
                      class="text-sm font-medium text-green-400"
                      id="modalCorrectCount"
                      >0</span
                    >
                  </div>
                  <div class="flex justify-between">
                    <span class="text-sm text-gray-300">Incorrect:</span>
                    <span
                      class="text-sm font-medium text-red-400"
                      id="modalIncorrectCount"
                      >0</span
                    >
                  </div>
                  <div class="flex justify-between">
                    <span class="text-sm text-gray-300">Partial:</span>
                    <span
                      class="text-sm font-medium text-yellow-400"
                      id="modalPartialCount"
                      >0</span
                    >
                  </div>
                  <div class="flex justify-between">
                    <span class="text-sm text-gray-300">Unattempted:</span>
                    <span
                      class="text-sm font-medium text-gray-400"
                      id="modalUnattemptedCount"
                      >0</span
                    >
                  </div>
                </div>
              </div>

              <div
                class="bg-purple-500/10 p-4 rounded-lg border border-purple-500/20"
              >
                <h5 class="font-semibold text-purple-300 mb-2">
                  Performance Analysis
                </h5>
                <div class="space-y-2">
                  <div class="text-sm text-gray-300">Difficulty Level:</div>
                  <div id="modalDifficultyLevel" class="text-sm font-medium">
                    -
                  </div>
                  <div class="w-full bg-gray-600 rounded-full h-2 mt-2">
                    <div
                      id="modalPerformanceBar"
                      class="h-2 rounded-full transition-all duration-300"
                      style="width: 0%"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card rounded-xl p-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center">
          <i class="fas fa-crown mr-3 text-yellow-400"></i>
          Top Performers (250+)
        </h2>
        <div class="grid gap-4" id="leaderboard"></div>
      </div>
    </div>

    <div
      id="errorModal"
      class="fixed inset-0 z-50 bg-black bg-opacity-75 flex items-center justify-center hidden"
    >
      <div
        class="bg-gray-800 p-6 sm:p-8 rounded-xl max-w-sm sm:max-w-md mx-4 text-center border border-gray-600 shadow-2xl"
      >
        <div class="mb-6">
          <div
            class="mx-auto w-16 h-16 bg-yellow-500/20 rounded-full flex items-center justify-center border border-yellow-500/30"
          >
            <i
              class="fas fa-sync-alt text-yellow-400 text-2xl animate-spin"
            ></i>
          </div>
        </div>
        <h2 class="text-2xl font-bold text-white mb-4">Stats Are Updating !</h2>
        <p class="text-gray-300 mb-6 leading-relaxed">
          Please check back in a few minutes while the data is being refreshed.
        </p>
      </div>
    </div>

    <script>
      let apiData = null;
      let chartInstance = null;
      let isChartView = false;

      async function fetchData() {
        const Url = "https://adv-stats-api.iitjeepritam.workers.dev/stats";
        const proxyUrl = `https://cors-proxy.novadrone16.workers.dev?url=${encodeURIComponent(
          Url
        )}`;
        try {
          const response = await fetch(proxyUrl);
          if (!response.ok) {
            document.getElementById("errorModal").classList.remove("hidden");
            return;
          }
          apiData = await response.json();
          displayData();
        } catch (error) {
          document.getElementById("errorModal").classList.remove("hidden");
          console.error("Error fetching data:", error);
        }
      }

      function displayData() {
        const lastUpdated = new Date(apiData.lastUpdated);

        const year = lastUpdated.getUTCFullYear();
        const month = (lastUpdated.getUTCMonth() + 1)
          .toString()
          .padStart(2, "0");
        const day = lastUpdated.getUTCDate().toString().padStart(2, "0");

        let hours = lastUpdated.getUTCHours();
        const minutes = lastUpdated.getUTCMinutes().toString().padStart(2, "0");

        const ampm = hours >= 12 ? "pm" : "am";
        hours = hours % 12;
        hours = hours ? hours : 12;

        document.getElementById(
          "lastUpdated"
        ).textContent = `Last Updated: ${day}/${month}/${year} ${hours}:${minutes}${ampm}`;

        document.getElementById("totalCount").textContent =
          apiData.totalStats.totalCount.toLocaleString();
        document.getElementById("activeUsers").textContent =
          apiData.analytics.realTime.activeUsersLast30Min;
        document.getElementById("highestScore").textContent =
          apiData.totalStats.highestScore;
        document.getElementById("top250Count").textContent =
          apiData.top250PlusScorers.count;

        //document.getElementById('physicsHigh').textContent = apiData.totalStats.subjectHighs.physics;
        //document.getElementById('chemistryHigh').textContent = apiData.totalStats.subjectHighs.chemistry;
        //document.getElementById('mathsHigh').textContent = apiData.totalStats.subjectHighs.maths;

        displayDistributionTable();

        displayPaperComparison();

        populatePerformanceExtremes(
          "physics",
          document.querySelector(
            "#questionAnalysisContainer + div .subject-toggle-btn.active"
          )
        );

        displayLeaderboard();

        showSubjectAnalysis(
          "physics",
          document.querySelector(".subject-toggle-btn.active")
        );

        addClickHandlersToExtremes();

        const analysisBtn = document.querySelector(
          "button[onclick*='showSubjectAnalysis'][onclick*='physics']"
        );
        if (analysisBtn) {
          showSubjectAnalysis("physics", analysisBtn);
        }

        const extremesBtn = document.querySelector(
          "button[onclick*='populatePerformanceExtremes'][onclick*='physics']"
        );
        if (extremesBtn) {
          populatePerformanceExtremes("physics", extremesBtn);
        }
      }

      function displayDistributionTable() {
        const tbody = document.getElementById("distributionTable");
        tbody.innerHTML = "";

        Object.entries(apiData.totalStats.totalRanges).forEach(
          ([range, count]) => {
            const percentage = (
              (count / apiData.totalStats.totalCount) *
              100
            ).toFixed(2);
            const row = document.createElement("tr");
            row.className = "border-b border-gray-700 hover:bg-gray-800/50";

            row.innerHTML = `
                    <td class="py-3 px-4 font-medium">${range}</td>
                    <td class="py-3 px-4 text-right">${count.toLocaleString()}</td>
                    <td class="py-3 px-4 text-right">${percentage}%</td>
                    <td class="py-3 px-4">
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="bg-blue-400 h-2 rounded-full" style="width: ${percentage}%"></div>
                        </div>
                    </td>
                `;
            tbody.appendChild(row);
          }
        );
      }

      function displayChart() {
        const ctx = document
          .getElementById("distributionChart")
          .getContext("2d");

        if (chartInstance) {
          chartInstance.destroy();
        }

        const labels = Object.keys(apiData.totalStats.totalRanges);
        const data = Object.values(apiData.totalStats.totalRanges);

        chartInstance = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Number of Students",
                data: data,
                backgroundColor: "rgba(59, 130, 246, 0.8)",
                borderColor: "rgba(59, 130, 246, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                labels: {
                  color: "white",
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  color: "white",
                },
                grid: {
                  color: "rgba(255, 255, 255, 0.1)",
                },
              },
              x: {
                ticks: {
                  color: "white",
                },
                grid: {
                  color: "rgba(255, 255, 255, 0.1)",
                },
              },
            },
          },
        });
      }

      function displayPaperComparison() {
        const paperComp = apiData.paperComparison.easierPaper;
        const total =
          paperComp.paper1Count + paperComp.paper2Count + paperComp.equal;

        const paper1Perc = ((paperComp.paper1Count / total) * 100).toFixed(1);
        const paper2Perc = ((paperComp.paper2Count / total) * 100).toFixed(1);
        const equalPerc = ((paperComp.equal / total) * 100).toFixed(1);

        document.getElementById("paper1Percentage").textContent =
          paper1Perc + "%";
        document.getElementById("paper2Percentage").textContent =
          paper2Perc + "%";
        document.getElementById("equalPercentage").textContent =
          equalPerc + "%";
        document.getElementById("paper1Bar").style.width = paper1Perc + "%";
        document.getElementById("paper2Bar").style.width = paper2Perc + "%";
        document.getElementById("equalBar").style.width = equalPerc + "%";

        const subjects = ["physics", "chemistry", "maths"];
        subjects.forEach((subject) => {
          const subjectData =
            apiData.paperComparison.subjectComparison[subject];
          const total =
            subjectData.paper1Better +
            subjectData.paper2Better +
            subjectData.equal;
          const p1Perc = ((subjectData.paper1Better / total) * 100).toFixed(0);
          const p2Perc = ((subjectData.paper2Better / total) * 100).toFixed(0);

          const analysis =
            p1Perc > p2Perc
              ? `${p1Perc}% of students performed better in Paper 1`
              : `${p2Perc}% of students performed better in Paper 2`;

          document.getElementById(subject + "Comparison").textContent =
            analysis;
        });
      }

      function showSubjectAnalysis(subject, clickedButton) {
        document.querySelectorAll(".analysis-toggle-btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        if (clickedButton) {
          clickedButton.classList.add("active");
        }

        currentSortColumn = null;
        currentSortDirection = "asc";

        document.querySelectorAll("thead th i").forEach((icon) => {
          icon.className = "fas fa-sort ml-1 text-gray-400";
        });

        document.querySelectorAll(".subject-analysis").forEach((div) => {
          div.classList.add("hidden");
        });

        document
          .getElementById(subject + "-analysis")
          .classList.remove("hidden");
        if (clickedButton) {
          clickedButton.classList.add("active");
        }

        populateQuestionTable(subject);
      }

      let currentSortColumn = null;
      let currentSortDirection = "asc";
      let currentSubjectData = null;

      function populateQuestionTable(subject) {
        currentSubjectData = subject;
        const tbody = document.getElementById(subject + "-table-body");
        tbody.innerHTML = "";

        if (
          apiData &&
          apiData.questionStats &&
          apiData.questionStats[subject] &&
          apiData.questionStats[subject].questionStats
        ) {
          let questions = [...apiData.questionStats[subject].questionStats];

          if (currentSortColumn) {
            questions = sortQuestionData(
              questions,
              currentSortColumn,
              currentSortDirection
            );
          }

          questions.forEach((question, index) => {
            const row = document.createElement("tr");
            row.className = "border-b border-gray-700 hover:bg-gray-800/50";

            const performanceClass =
              parseFloat(question.correctPct) > 40
                ? "text-green-400"
                : parseFloat(question.correctPct) > 20
                ? "text-yellow-400"
                : "text-red-400";

            const originalIndex = apiData.questionStats[
              subject
            ].questionStats.findIndex((q) => q.qid === question.qid);

            row.innerHTML = `
                <td class="py-3 px-4">
                    <div class="flex items-center space-x-3">
                        <img src="${question.questionImg}" alt="Q${
              originalIndex + 1
            }"
                             class="w-12 h-10 object-contain bg-white rounded border cursor-pointer hover:scale-105 transition-transform"
                             onclick="openQuestionModal(apiData.questionStats['${subject}'].questionStats[${originalIndex}], ${
              originalIndex + 1
            }, '${subject}')">
                        <span class="font-medium">Q${originalIndex + 1}</span>
                    </div>
                </td>
                <td class="py-3 px-4 text-center">
                    <span class="px-2 py-1 bg-blue-500/20 text-blue-300 rounded text-xs">${
                      question.paperNo
                    }</span>
                </td>
                <td class="py-3 px-4 text-center">
                    <span class="px-2 py-1 bg-purple-500/20 text-purple-300 rounded text-xs">${
                      question.section
                    }</span>
                </td>
                <td class="py-3 px-4 text-right font-semibold text-green-400">${
                  question.correctPct
                }%</td>
                <td class="py-3 px-4 text-right font-semibold text-red-400">${
                  question.incorrectPct
                }%</td>
                <td class="py-3 px-4 text-right font-semibold text-yellow-400">${
                  question.partialCorrectPct
                }%</td>
                <td class="py-3 px-4 text-right font-semibold text-gray-400">${
                  question.unattemptedPct
                }%</td>
                <!--<td class="py-3 px-4">
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div class="h-2 rounded-full ${performanceClass.replace(
                          "text-",
                          "bg-"
                        )}"
                             style="width: ${question.correctPct}%"></div>
                    </div>
                </td>-->
            `;
            tbody.appendChild(row);
          });
        }
      }

      function sortTable(column, headerElement) {
        document.querySelectorAll("thead th i").forEach((icon) => {
          icon.className = "fas fa-sort ml-1 text-gray-400";
        });

        if (currentSortColumn === column) {
          currentSortDirection =
            currentSortDirection === "asc" ? "desc" : "asc";
        } else {
          currentSortDirection = "asc";
          currentSortColumn = column;
        }

        const icon = headerElement.querySelector("i");
        if (currentSortDirection === "asc") {
          icon.className = "fas fa-sort-up ml-1 text-blue-400";
        } else {
          icon.className = "fas fa-sort-down ml-1 text-blue-400";
        }

        populateQuestionTable(currentSubjectData);
      }

      function sortQuestionData(questions, column, direction) {
        return questions.sort((a, b) => {
          let valueA, valueB;

          switch (column) {
            case "correct":
              valueA = parseFloat(a.correctPct);
              valueB = parseFloat(b.correctPct);
              break;
            case "incorrect":
              valueA = parseFloat(a.incorrectPct);
              valueB = parseFloat(b.incorrectPct);
              break;
            case "partial":
              valueA = parseFloat(a.partialCorrectPct);
              valueB = parseFloat(b.partialCorrectPct);
              break;
            case "unattempted":
              valueA = parseFloat(a.unattemptedPct);
              valueB = parseFloat(b.unattemptedPct);
              break;
            default:
              return 0;
          }

          if (direction === "asc") {
            return valueA - valueB;
          } else {
            return valueB - valueA;
          }
        });
      }

      function addClickHandlersToExtremes() {
        const subjects = ["physics", "chemistry", "maths"];

        subjects.forEach((subject) => {
          const subjectData = apiData?.questionStats?.[subject];
          if (!subjectData) return;

          const prefix = subject + "-";

          document.getElementById(prefix + "highest-correct-question").onclick =
            function () {
              openQuestionModal(subjectData.highestCorrect, "HC", subject);
            };

          document.getElementById(prefix + "lowest-correct-question").onclick =
            function () {
              openQuestionModal(subjectData.lowestCorrect, "LC", subject);
            };

          document.getElementById(
            prefix + "highest-incorrect-question"
          ).onclick = function () {
            openQuestionModal(subjectData.highestIncorrect, "HI", subject);
          };

          document.getElementById(
            prefix + "highest-unattempted-question"
          ).onclick = function () {
            openQuestionModal(subjectData.highestUnattempted, "HU", subject);
          };

          [
            "highest-correct-question",
            "lowest-correct-question",
            "highest-incorrect-question",
            "highest-unattempted-question",
          ].forEach((type) => {
            const el = document.getElementById(prefix + type);
            if (el) {
              el.classList.add(
                "cursor-pointer",
                "hover:scale-105",
                "transition-transform"
              );
            }
          });
        });
      }

      function populatePerformanceExtremes(subject, clickedButton = null) {
        document.querySelectorAll(".subject-extremes").forEach((div) => {
          div.classList.add("hidden");
        });

        document.querySelectorAll(".subject-toggle-btn").forEach((btn) => {
          btn.classList.remove("active");
        });

        document
          .getElementById(`${subject}-extremes`)
          .classList.remove("hidden");

        if (clickedButton) {
          clickedButton.classList.add("active");
        }
        if (
          !apiData ||
          !apiData.questionStats ||
          !apiData.questionStats[subject]
        ) {
          console.warn(
            `API data for performance extremes for subject ${subject} is not available.`
          );
          return;
        }

        const subjectData = apiData.questionStats[subject];

        const highestCorrect = subjectData.highestCorrect;
        if (highestCorrect) {
          document.getElementById(
            `${subject}-highest-correct-rate`
          ).textContent = highestCorrect.correctPct + "%";
          document.getElementById(`${subject}-highest-correct-question`).src =
            highestCorrect.questionImg;
          document.getElementById(
            `${subject}-highest-correct-paper`
          ).textContent = highestCorrect.paperNo;
          document.getElementById(
            `${subject}-highest-correct-section`
          ).textContent = highestCorrect.section;
          document.getElementById(
            `${subject}-highest-correct-count`
          ).textContent = highestCorrect.correctCount
            ? highestCorrect.correctCount.toLocaleString()
            : "N/A";
          document.getElementById(
            `${subject}-highest-correct-bar`
          ).style.width = highestCorrect.correctPct + "%";
        }

        const lowestCorrect = subjectData.lowestCorrect;
        if (lowestCorrect) {
          document.getElementById(
            `${subject}-lowest-correct-rate`
          ).textContent = lowestCorrect.correctPct + "%";
          document.getElementById(`${subject}-lowest-correct-question`).src =
            lowestCorrect.questionImg;
          document.getElementById(
            `${subject}-lowest-correct-paper`
          ).textContent = lowestCorrect.paperNo;
          document.getElementById(
            `${subject}-lowest-correct-section`
          ).textContent = lowestCorrect.section;
          document.getElementById(
            `${subject}-lowest-correct-count`
          ).textContent = lowestCorrect.correctCount
            ? lowestCorrect.correctCount.toLocaleString()
            : "N/A";
          document.getElementById(`${subject}-lowest-correct-bar`).style.width =
            lowestCorrect.correctPct + "%";
        }

        const highestIncorrect = subjectData.highestIncorrect;
        if (highestIncorrect) {
          document.getElementById(
            `${subject}-highest-incorrect-rate`
          ).textContent = highestIncorrect.incorrectPct + "%";
          document.getElementById(`${subject}-highest-incorrect-question`).src =
            highestIncorrect.questionImg;
          document.getElementById(
            `${subject}-highest-incorrect-paper`
          ).textContent = highestIncorrect.paperNo;
          document.getElementById(
            `${subject}-highest-incorrect-section`
          ).textContent = highestIncorrect.section;
          document.getElementById(
            `${subject}-highest-incorrect-count`
          ).textContent = highestIncorrect.incorrectCount
            ? highestIncorrect.incorrectCount.toLocaleString()
            : "N/A";
          document.getElementById(
            `${subject}-highest-incorrect-bar`
          ).style.width = highestIncorrect.incorrectPct + "%";
        }

        const highestUnattempted = subjectData.highestUnattempted;
        if (highestUnattempted) {
          document.getElementById(
            `${subject}-highest-unattempted-rate`
          ).textContent = highestUnattempted.unattemptedPct + "%";
          document.getElementById(
            `${subject}-highest-unattempted-question`
          ).src = highestUnattempted.questionImg;
          document.getElementById(
            `${subject}-highest-unattempted-paper`
          ).textContent = highestUnattempted.paperNo;
          document.getElementById(
            `${subject}-highest-unattempted-section`
          ).textContent = highestUnattempted.section;
          document.getElementById(
            `${subject}-highest-unattempted-count`
          ).textContent = highestUnattempted.unattemptedCount
            ? highestUnattempted.unattemptedCount.toLocaleString()
            : "N/A";
          document.getElementById(
            `${subject}-highest-unattempted-bar`
          ).style.width = highestUnattempted.unattemptedPct + "%";
        }
      }

      const style = document.createElement("style");
      style.textContent = `
    .analysis-toggle-btn.active {
        background-color: rgba(234, 179, 8, 0.2) !important;
        border-color: rgba(234, 179, 8, 0.5) !important;
        color: rgb(250, 204, 21) !important;
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(234, 179, 8, 0.2);
    }
    .subject-toggle-btn.active {
        background-color: rgba(234, 179, 8, 0.2) !important;
        border-color: rgba(234, 179, 8, 0.5) !important;
        color: rgb(250, 204, 21) !important;
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(234, 179, 8, 0.2);
    }
`;
      document.head.appendChild(style);

      function openQuestionModal(questionData, questionNumber, subject) {
        const modal = document.getElementById("questionModal");

        document.getElementById(
          "modalQuestionNumber"
        ).textContent = `Q${questionNumber}`;
        document.getElementById("modalPaperNo").textContent =
          questionData.paperNo;
        document.getElementById("modalSection").textContent =
          questionData.section;
        document.getElementById("modalSubject").textContent =
          subject.charAt(0).toUpperCase() + subject.slice(1);

        document.getElementById("modalCorrectPct").textContent =
          questionData.correctPct + "%";
        document.getElementById("modalIncorrectPct").textContent =
          questionData.incorrectPct + "%";
        document.getElementById("modalPartialPct").textContent =
          questionData.partialCorrectPct + "%";
        document.getElementById("modalUnattemptedPct").textContent =
          questionData.unattemptedPct + "%";

        document.getElementById("modalQuestionImg").src =
          questionData.questionImg;

        const answerContainer = document.getElementById(
          "modalAnswerImgContainer"
        );
        answerContainer.innerHTML = "";

        if (
          questionData.correctAnswerImg &&
          questionData.correctAnswerImg.length > 0
        ) {
          questionData.correctAnswerImg.forEach((imgUrl) => {
            const img = document.createElement("img");
            img.src = imgUrl;
            img.alt = "Correct Answer";
            img.className =
              "w-full h-auto max-h-96 object-contain mx-auto bg-white rounded-lg border border-gray-400 p-2 shadow-sm";
            answerContainer.appendChild(img);
          });
        } else {
          const fallback = document.createElement("div");
          fallback.textContent = `${questionData.correctAnswerId || "N/A"}`;
          fallback.className =
            "text-gray-800 text-center text-lg font-semibold";
          answerContainer.appendChild(fallback);
        }

        document.getElementById("modalCorrectCount").textContent = (
          questionData.correctCount || 0
        ).toLocaleString();
        document.getElementById("modalIncorrectCount").textContent = (
          questionData.incorrectCount || 0
        ).toLocaleString();
        document.getElementById("modalPartialCount").textContent = (
          questionData.partialCount || 0
        ).toLocaleString();
        document.getElementById("modalUnattemptedCount").textContent = (
          questionData.unattemptedCount || 0
        ).toLocaleString();

        const correctRate = parseFloat(questionData.correctPct);
        let difficultyLevel, difficultyColor;

        if (correctRate >= 70) {
          difficultyLevel = "Easy";
          difficultyColor = "bg-green-400";
        } else if (correctRate >= 40) {
          difficultyLevel = "Medium";
          difficultyColor = "bg-yellow-400";
        } else if (correctRate >= 20) {
          difficultyLevel = "Hard";
          difficultyColor = "bg-orange-400";
        } else {
          difficultyLevel = "Very Hard";
          difficultyColor = "bg-red-400";
        }

        document.getElementById("modalDifficultyLevel").textContent =
          difficultyLevel;
        document.getElementById(
          "modalDifficultyLevel"
        ).className = `text-sm font-medium ${difficultyColor.replace(
          "bg-",
          "text-"
        )}`;

        const performanceBar = document.getElementById("modalPerformanceBar");
        performanceBar.className = `h-2 rounded-full transition-all duration-300 ${difficultyColor}`;
        performanceBar.style.width = questionData.correctPct + "%";

        modal.classList.remove("hidden");
        document.body.style.overflow = "hidden";
      }

      function closeQuestionModal() {
        const modal = document.getElementById("questionModal");
        modal.classList.add("hidden");
        document.body.style.overflow = "auto";
      }

      document
        .getElementById("questionModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeQuestionModal();
          }
        });

      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closeQuestionModal();
        }
      });

      function displayLeaderboard() {
        const leaderboard = document.getElementById("leaderboard");
        leaderboard.innerHTML = "";

        apiData.top250PlusScorers.students.forEach((student, index) => {
          const item = document.createElement("div");
          item.className = "leaderboard-item p-4 rounded-lg";
          item.style.animationDelay = `${index * 0.1}s`;

          const rankIcon =
            index < 3 ? ["", "", ""][index] : `#${student.rank}`;

          item.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="text-2xl font-bold w-12 text-center">
                                ${rankIcon}
                            </div>
                            <div>
                                <div class="font-bold text-lg">${student.totalMarks} marks</div>
                                <div class="text-sm text-gray-400">
                                    P1: ${student.paper1Marks} | P2: ${student.paper2Marks} | Positive: ${student.positiveScore}
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-300">
                                <span class="text-red-300">P: ${student.physicsScore}</span> |
                                <span class="text-blue-300">C: ${student.chemistryScore}</span> |
                                <span class="text-green-300">M: ${student.mathsScore}</span>
                            </div>
                        </div>
                    </div>
                `;
          leaderboard.appendChild(item);
        });
      }

      document
        .getElementById("toggleView")
        .addEventListener("click", function () {
          const tableView = document.getElementById("tableView");
          const chartView = document.getElementById("chartView");
          const toggleBtn = document.getElementById("toggleView");

          if (isChartView) {
            tableView.classList.remove("hidden");
            chartView.classList.add("hidden");
            toggleBtn.innerHTML = '<i class="fas fa-chart-bar"></i>';
            isChartView = false;
          } else {
            tableView.classList.add("hidden");
            chartView.classList.remove("hidden");
            toggleBtn.innerHTML = '<i class="fas fa-table"></i>';
            displayChart();
            isChartView = true;
          }
        });
      document.addEventListener("DOMContentLoaded", function () {
        addClickHandlersToExtremes();
      });

      fetchData();
      addClickHandlersToExtremes();
    </script>
  </body>
</html>
